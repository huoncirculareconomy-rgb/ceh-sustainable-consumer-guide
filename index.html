<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CEH Sustainable Consumer Guide</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
:root{
  --bg:#f6f3ef;
  --panel:#fbf8f4;
  --card:#f8f6f3;
  --border:#d9d9d9;
  --text:#24323f;
  --muted:#777;
  --title:#2e8b57;

  --blue-bg:#e6f0ff;
  --blue-bd:#bcd2ff;
  --blue-tx:#0b3ea9;

  --green-bg:#e7f6ea;
  --green-bd:#b9e2c2;
  --green-tx:#1a6b2f;

  --pill-active:#333;

  --btn:#1f66d1;
  --btn-dark:#154ea3;
}

*{ box-sizing:border-box }

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

.wrap{
  max-width:1200px;
  margin:auto;
  padding:22px 18px 28px;
}

h1{
  text-align:center;
  color:var(--title);
  margin:8px 0 4px;
}

.slogan{
  text-align:center;
  font-style:italic;
  min-height:1.4em;
  margin-bottom:18px;
}

.controls{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px;
}

.controls-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}

.input,.select,.btn{
  height:42px;
  padding:0 12px;
  font-size:14px;
  border-radius:8px;
  border:1px solid #7d7d7d;
}

.input{ flex:1 1 360px; }
.select{ flex:0 1 220px; }

.btn{
  background:var(--btn);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
.btn:hover{ background:var(--btn-dark); }

.grid{
  margin-top:16px;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:16px;
}

@media(max-width:900px){
  .grid{ grid-template-columns:repeat(2,1fr); }
}
@media(max-width:600px){
  .grid{ grid-template-columns:1fr; }
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px;
}

.name{
  font-weight:800;
  margin-bottom:8px;
}

.bullets{
  display:grid;
  gap:6px;
  margin-bottom:10px;
}

.bullet{
  display:grid;
  grid-template-columns:14px 1fr;
  gap:6px;
  font-size:13.5px;
}

.chev{ font-weight:700; }

.pills{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin-bottom:8px;
}

.pill{
  font-size:12px;
  padding:3px 9px;
  border-radius:999px;
  border:1px solid transparent;
  background:none;
  cursor:pointer;
}

.pill.blue{
  background:var(--blue-bg);
  border-color:var(--blue-bd);
  color:var(--blue-tx);
}

.pill.green{
  background:var(--green-bg);
  border-color:var(--green-bd);
  color:var(--green-tx);
}

.pill.active{
  box-shadow:0 0 0 1px var(--pill-active);
  font-weight:600;
}

footer{
  margin-top:18px;
  text-align:center;
  font-size:12.5px;
  color:var(--muted);
}
</style>
</head>

<body>
<div class="wrap">

<h1>CEH Sustainable Consumer Guide</h1>
<div class="slogan" id="slogan"></div>

<div class="controls">
  <div class="controls-row">
    <input id="search" class="input" placeholder="Searchâ€¦" />
    <select id="locationFilter" class="select"></select>
    <select id="practiceFilter" class="select"></select>
    <button class="btn" onclick="resetFilters()">Reset filters</button>
  </div>
  <div class="meta" id="resultCount"></div>
</div>

<div class="grid" id="cards"></div>
<footer id="updated"></footer>

</div>

<script>
const DATA_CSV =
 "https://docs.google.com/spreadsheets/d/1Nm4LnfbmopYYSSRL6oGt2trWsIehBKYeUf_rl2pKYYg/export?format=csv&gid=2076497318";

let allData = [];
let filtered = [];

let activeCategory = null;
let activePractice = null;

const splitClean = v =>
  v ? v.split(",").map(x=>x.trim()).filter(Boolean) : [];

const bulletise = text =>
  text ? text.split(".").map(t=>t.trim()).filter(Boolean)
    .map(t=>`
      <div class="bullet">
        <div class="chev">&gt;</div>
        <div>${t}.</div>
      </div>`).join("") : "";

Papa.parse(DATA_CSV,{
  download:true,
  header:true,
  complete:r=>{
    allData = r.data.filter(x => x.Name);
    allData.sort((a,b)=>new Date(b.Date)-new Date(a.Date));
    buildFilters();
    applyFilters();
    updated.textContent =
      "Data last updated: " + new Date().toLocaleDateString();
  }
});

function buildFilters(){
  const loc = new Set();
  const prac = new Set();

  allData.forEach(r=>{
    splitClean(r.Location).forEach(x=>loc.add(x));
    splitClean(r.Practices).forEach(x=>prac.add(x));
  });

  locationFilter.innerHTML =
    `<option value="">All locations</option>` +
    [...loc].sort().map(x=>`<option>${x}</option>`).join("");

  practiceFilter.innerHTML =
    `<option value="">All practices</option>` +
    [...prac].sort().map(x=>`<option>${x}</option>`).join("");
}

search.oninput =
locationFilter.onchange =
practiceFilter.onchange = applyFilters;

function resetFilters(){
  search.value="";
  locationFilter.value="";
  practiceFilter.value="";
  activeCategory = null;
  activePractice = null;
  applyFilters();
}

function togglePill(type,value){
  if(type==="category"){
    activeCategory = activeCategory===value ? null : value;
  } else {
    activePractice = activePractice===value ? null : value;
  }
  applyFilters();
}

function applyFilters(){
  const q = search.value.toLowerCase();

  filtered = allData.filter(r=>{
    if(locationFilter.value && !r.Location?.includes(locationFilter.value)) return false;
    if(practiceFilter.value && !r.Practices?.includes(practiceFilter.value)) return false;

    if(activeCategory && !splitClean(r.Category).includes(activeCategory)) return false;
    if(activePractice && !splitClean(r.Practices).includes(activePractice)) return false;

    return JSON.stringify(r).toLowerCase().includes(q);
  });

  render();
}

function render(){
  cards.innerHTML = filtered.map(r=>`
    <div class="card">
      <div class="name">${r.Name}</div>
      <div class="bullets">${bulletise(r["Product/Service"])}</div>

      <div class="pills">
        ${splitClean(r.Category).map(c=>`
          <button class="pill blue ${activeCategory===c?"active":""}"
            onclick="togglePill('category','${c.replace(/'/g,"&#39;")}')">${c}</button>
        `).join("")}
      </div>

      <div class="pills">
        ${splitClean(r.Practices).map(p=>`
          <button class="pill green ${activePractice===p?"active":""}"
            onclick="togglePill('practice','${p.replace(/'/g,"&#39;")}')">${p}</button>
        `).join("")}
      </div>
    </div>
  `).join("");

  resultCount.textContent =
    `Showing ${filtered.length} of ${allData.length} results`;
}
</script>
</body>
</html>
