<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CEH Sustainable Consumer Guide</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!--
PURPOSE AND FUNCTION
--------------------
This page displays the CEH Sustainable Consumer Guide using data loaded
directly from a published Google Sheets CSV. It provides searchable,
filterable cards for local businesses, supports mobile and desktop
layouts, and is designed to be safely embedded or linked from Google Sites.
All logic (data loading, filtering, rendering) is client-side and
independent of Google Sites internals.
-->

<style>
/* ===== Base ===== */
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: #f6f3ee;
  margin: 0;
  padding: 0;
  color: #1f2937;
}

.container {
  max-width: 1200px;
  margin: auto;
  padding: 20px;
}

/* ===== Header ===== */
h1 {
  color: #2f8f5b;
  margin-bottom: 6px;
}

.subtitle {
  font-style: italic;
  color: #555;
  margin-bottom: 20px;
}

/* ===== Filters ===== */
.filters {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr auto;
  gap: 10px;
  margin-bottom: 10px;
}

@media (max-width: 700px) {
  .filters {
    grid-template-columns: 1fr;
  }
}

input, select, button {
  font-size: 16px;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

button {
  background: #1a73e8;
  color: #fff;
  border-color: #1a73e8;
  cursor: pointer;
}

button:hover {
  background: #155ec2;
}

#resultsCount {
  font-size: 14px;
  color: #555;
  margin-bottom: 14px;
}

/* ===== Cards grid ===== */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 14px;
}

@media (max-width: 700px) {
  .cards {
    grid-template-columns: 1fr;
  }
}

/* ===== Card styling (Steps 1â€“6) ===== */
.card {
  background: #f7f5f2;
  border: 1px solid #d9d9d9;
  border-radius: 14px;
  padding: 16px 18px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.card h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}

.card .description {
  font-size: 14.5px;
  line-height: 1.45;
  color: #374151;
}

.card a {
  color: #1a73e8;
  text-decoration: none;
  word-break: break-word;
}

.card a:hover {
  text-decoration: underline;
}

/* ===== Tags ===== */
.tags {
  margin-top: 6px;
}

.tag {
  display: inline-block;
  padding: 4px 10px;
  font-size: 12px;
  border-radius: 999px;
  background: #e6f2ff;
  color: #1a4fb3;
  border: 1px solid #c7dcff;
  margin: 2px 4px 0 0;
  cursor: pointer;
}

.tag:hover {
  background: #d4e9ff;
}

/* ===== Hover lift ===== */
@media (hover: hover) {
  .card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
}
</style>
</head>

<body>
<div class="container">
  <h1>CEH Sustainable Consumer Guide</h1>
  <div class="subtitle">Choose local. Reduce waste. Strengthen the Huon Valley.</div>

  <div class="filters">
    <input id="search" placeholder="Search businesses or services">
    <select id="locationFilter">
      <option value="">All locations</option>
    </select>
    <select id="practiceFilter">
      <option value="">All practices</option>
    </select>
    <button id="resetFilters">Reset filters</button>
  </div>

  <div id="resultsCount"></div>

  <div id="cards" class="cards"></div>
</div>

<script>
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vSuhA8ku2ftsdQaepAZucZWIHmVuwaLO2xq8_d8y5QIOBfCwRBDsWH9A5crAbsAcK3TFM1fcWMTVJjs/pub?gid=2076497318&single=true&output=csv";

const cardsEl = document.getElementById("cards");
const searchEl = document.getElementById("search");
const locEl = document.getElementById("locationFilter");
const pracEl = document.getElementById("practiceFilter");
const resultsEl = document.getElementById("resultsCount");

let rows = [];

function splitTokens(str) {
  if (!str) return [];
  return str.split(/[,;/]/).map(s => s.trim()).filter(Boolean);
}

function parseCSV(text) {
  const lines = text.trim().split("\n");
  const headers = lines.shift().split(",").map(h => h.trim());
  return lines.map(line => {
    const cols = line.split(",").map(c => c.trim());
    return Object.fromEntries(headers.map((h, i) => [h, cols[i] || ""]));
  });
}

function populateFilters() {
  const locations = new Set();
  const practices = new Set();

  rows.forEach(r => {
    splitTokens(r.Location).forEach(l => locations.add(l));
    splitTokens(r.Practices).forEach(p => practices.add(p));
  });

  [...locations].sort().forEach(l =>
    locEl.add(new Option(l, l))
  );
  [...practices].sort().forEach(p =>
    pracEl.add(new Option(p, p))
  );
}

function renderCards() {
  const q = searchEl.value.toLowerCase();
  const loc = locEl.value;
  const prac = pracEl.value;

  const filtered = rows.filter(r => {
    const textMatch =
      r.Name.toLowerCase().includes(q) ||
      r["Product/Service"].toLowerCase().includes(q);

    const locMatch = !loc || splitTokens(r.Location).includes(loc);
    const pracMatch = !prac || splitTokens(r.Practices).includes(prac);

    return textMatch && locMatch && pracMatch && r.Status.toLowerCase() === "active";
  });

  resultsEl.textContent = `Showing ${filtered.length} of ${rows.length} results`;

  cardsEl.innerHTML = "";

  filtered.forEach(r => {
    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <h3>${r.Name}</h3>
      <div class="description">${r["Product/Service"]}</div>
      ${r.Website ? `<a href="${r.Website}" target="_blank">${r.Website}</a>` : ""}
      <div class="tags">
        ${splitTokens(r.Practices).map(p =>
          `<span class="tag" data-practice="${p}">${p}</span>`
        ).join("")}
      </div>
    `;
    cardsEl.appendChild(card);
  });
}

cardsEl.addEventListener("click", e => {
  const tag = e.target.closest(".tag");
  if (!tag) return;
  pracEl.value = tag.dataset.practice;
  renderCards();
});

document.getElementById("resetFilters").onclick = () => {
  searchEl.value = "";
  locEl.value = "";
  pracEl.value = "";
  renderCards();
};

[searchEl, locEl, pracEl].forEach(el =>
  el.addEventListener("input", renderCards)
);

fetch(CSV_URL)
  .then(r => r.text())
  .then(text => {
    rows = parseCSV(text);
    populateFilters();
    renderCards();
  });
</script>
</body>
</html>
