<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!--
PURPOSE & FUNCTION
This page implements a minimal standalone version of the CEH Sustainable Consumer Guide.
It loads directory data from a published Google Sheets CSV, parses it client-side,
and renders simple cards. This confirms that GitHub Pages, JavaScript execution,
and the data source are all working reliably.
-->

<title>CEH Sustainable Consumer Guide</title>

<style>
  body {
    margin: 0;
    font-family: system-ui, Arial, sans-serif;
    background: #f7f5f2;
    color: #111;
  }
  header {
    padding: 20px;
    text-align: center;
    background: #f5f2ef;
    border-bottom: 1px solid #e5e7eb;
  }
  h1 {
    margin: 0;
    color: #2e8b57;
    font-weight: 600;
  }
  .status {
    padding: 12px;
    font-style: italic;
    color: #555;
    text-align: center;
  }
  .cards {
    padding: 16px;
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
  }
  @media (min-width: 700px) {
    .cards { grid-template-columns: repeat(2, 1fr); }
  }
  @media (min-width: 1100px) {
    .cards { grid-template-columns: repeat(3, 1fr); }
  }
  .card {
    background: #fff;
    border: 1px solid #d1d5db;
    border-radius: 12px;
    padding: 12px;
  }
  .card h3 {
    margin: 0 0 6px 0;
    font-size: 16px;
  }
  .muted {
    color: #6b7280;
    font-style: italic;
    font-size: 14px;
  }
</style>
</head>

<body>

<header>
  <h1>CEH Sustainable Consumer Guide</h1>
</header>

<div id="status" class="status">Loading directoryâ€¦</div>
<div id="cards" class="cards"></div>

<script>
/* ===== CONFIGURATION ===== */

// Published CSV URL (directory sheet)
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vSuhA8ku2ftsdQaepAZucZWIHmVuwaLO2xq8_d8y5QIOBfCwRBDsWH9A5crAbsAcK3TFM1fcWMTVJjs/pub?gid=2076497318&single=true&output=csv";

/* ===== UTILITIES ===== */

function escapeHTML(s) {
  return (s || "").replace(/[&<>"']/g, c => (
    { "&":"&amp;", "<":"&lt;", ">":"&gt;", "\"":"&quot;", "'":"&#39;" }[c]
  ));
}

function parseCSV(text) {
  const rows = [];
  let row = [], cell = "", inQuotes = false;

  for (let i = 0; i < text.length; i++) {
    const c = text[i], n = text[i + 1];

    if (c === '"') {
      if (inQuotes && n === '"') {
        cell += '"';
        i++;
      } else {
        inQuotes = !inQuotes;
      }
    } else if (c === ',' && !inQuotes) {
      row.push(cell);
      cell = "";
    } else if ((c === '\n' || c === '\r') && !inQuotes) {
      if (cell || row.length) {
        row.push(cell);
        rows.push(row);
        row = [];
        cell = "";
      }
    } else {
      cell += c;
    }
  }

  if (cell || row.length) {
    row.push(cell);
    rows.push(row);
  }

  const headers = rows.shift().map(h => h.trim());
  return rows
    .filter(r => r.some(v => v && v.trim()))
    .map(r => {
      const obj = {};
      headers.forEach((h, i) => obj[h] = (r[i] || "").trim());
      return obj;
    });
}

/* ===== LOAD & RENDER ===== */

fetch(CSV_URL + "&_=" + Date.now())
  .then(r => r.text())
  .then(text => {
    const data = parseCSV(text)
      .filter(r => !r.Status || r.Status.toLowerCase() === "active");

    const cards = document.getElementById("cards");
    const status = document.getElementById("status");

    cards.innerHTML = "";

    if (!data.length) {
      status.textContent = "No entries found.";
      return;
    }

    data.forEach(r => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>${escapeHTML(r.Name)}</h3>
        <div>${escapeHTML(r["Product / Service"] || r.Product || "")}</div>
        ${r.Location ? `<div class="muted">${escapeHTML(r.Location)}</div>` : ""}
      `;
      cards.appendChild(card);
    });

    status.textContent = "Showing " + data.length + " entries";
  })
  .catch(err => {
    document.getElementById("status").textContent =
      "Directory failed to load.";
  });
</script>

</body>
</html>
